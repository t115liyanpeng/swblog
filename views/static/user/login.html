<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8"/>
        <meta name="renderer" content="webkit">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
        <link rel="stylesheet" href="../../../static/layui/css/modules/code.css"/>
        <link rel="stylesheet" href="../../../static/layui/css/layui.css" media="all"/>
        <link rel="icon" href="../../../favicon.ico"/>
        <link rel="stylesheet" href="../../../static/user/user.css"/>
        <script src="../../../static/layui/layui.js"></script>
        <script src="../../../static/md5.js"></script>
        <title>欢迎登录</title>
    </head>
    <body>
        <!--整体容器-->
        <div id="continer">
            <!--登录框-->
            <div id="login_continer">
                <!--标题-->
            <div id="login_title">
                <h2>欢迎使用SwBlog</h2>                
            </div>
              <div>
                  
                    <form class="layui-form" method="POST">
                        <input type="text" name="username" id="username" required lay-verify="required" placeholder="用户名" class="layui-input"/>
                                               
                        <input type="password" name="password" id="password" required lay-verify="required" placeholder="密码" class="layui-input"/>
                        <div class="checkbox-item">
                            <input type="checkbox"  name="chksave" id="chksave"  lay-skin="primary" class="layui-input"/>
                            <label for="chksave">记住密码</label>
                        </div>                                       
                        <button id="ckbtn" type="submit" lay-submit lay-filter="login" class="layui-btn layui-btn-normal layui-btn-radius" >登&nbsp;&nbsp;入</button>
                    </form>
               
                </div>
                
            </div>
        </div>
        <script>
            layui.use('form',function(){
                var form=layui.form;
                form.on('submit(login)',function(data){
                    /*
                    var loading = layer.load(2, {
                    shade: 0.5,
                   
                    });
                    */
                    var loading = layer.msg('正在登录', {icon: 16, shade: 0.3, time:0});
                    var username=data.field.username
                    var password=hex_md5(data.field.password);
                    var xmlhttp;
                    if (window.XMLHttpRequest) {
                            //  IE7+, Firefox, Chrome, Opera, Safari 浏览器执行代码
                            xmlhttp = new XMLHttpRequest();
                    } else {
                             // IE6, IE5 浏览器执行代码
                            xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
                    }

                    
                    xmlhttp.onreadystatechange=change_state;
                    xmlhttp.open("POST","/user/login",true);
                    xmlhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
                    xmlhttp.send("username=" + username + "&password=" + password);

                    function change_state(){
                        //请求已完成且响应已就绪
                        if(xmlhttp.readyState==4){
                            if(xmlhttp.status==200){
                                layer.close(loading);
                                var res = JSON.parse(xmlhttp.response); 
                                if(res.code==0){
                                    layer.open({
                                        title:"欢迎回来",
                                        content:"你好，"+res.name+"!"
                                    });
                                    //跳转页面

                                }else{
                                    layer.open({
                                        title:"登录失败",
                                        content:res.msg
                                    });
                                }
                            }else{
                                layer.close(loading);
                                layer.open({
                                title: '服务器无响应',
                                content: "服务器跑到月球啦！！"
                        });
                            }
                        }
                    }                   
                    return false;
                });
            });
        </script>
    </body>
</html>